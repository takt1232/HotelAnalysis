{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <!-- Basic -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- Mobile Metas -->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <!-- Site Metas -->
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta name="author" content="" />

    <title>HotelInsightHub.com</title>

    <!-- bootstrap core css -->
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'css/bootstrap.css' %}"
    />

    <!-- fonts style -->
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap"
      rel="stylesheet"
    />
    <!-- font awesome style -->
    <link href="{% static 'css/font-awesome.min.css' %}" rel="stylesheet" />
    <!-- Custom styles for this template -->
    <link href="{% static 'css/style.css' %}" rel="stylesheet" />
    <!-- responsive style -->
    <link href="{% static 'css/responsive.css' %}" rel="stylesheet" />
  </head>

  <body>
    <div class="hero_area">
      <!-- header section strats -->
      <header class="header_section">
        <div class="header_bottom">
          <div class="container-fluid">
            <nav class="navbar navbar-expand-lg custom_nav-container">
              <a class="navbar-brand" href="{% url 'index' %}">
                <img src="{% static 'images/logo.jpg' %}" alt="" />
              </a>

              <button
                class="navbar-toggler"
                type="button"
                data-toggle="collapse"
                data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent"
                aria-expanded="false"
                aria-label="Toggle navigation"
              >
                <span class=""> </span>
              </button>

              <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <div
                  class="d-flex mr-auto flex-column flex-lg-row align-items-center"
                >
                  <ul class="navbar-nav">
                    <li class="nav-item active">
                      <a class="nav-link" href="{% url 'index' %}"
                        >Home <span class="sr-only">(current)</span></a
                      >
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="about.html"> About</a>
                    </li>
                  </ul>
                </div>
              </div>
            </nav>
          </div>
        </div>
      </header>
    </div>

    <section class="page-nav">
      <div class="page-nav-container">
        <div class="description-nav nav-item active">
          <a href="#description">Description</a>
        </div>
        <div class="clean-tool-nav nav-item">
          <a href="#clean-tool">Tools</a>
        </div>
        <div class="visualization-nav nav-item">
          <a href="#visualization">Visualization</a>
        </div>
        <div class="visualization-nav nav-item">
          <a href="#test">Test</a>
        </div>
      </div>
    </section>

    <section id="description" class="about_section active-section">
      <div class="container">
        {% if csv_description %}
        <div class="csv-description">
          <h2>CSV Description</h2>
          <ul>
            <li>
              <strong>Shape:</strong> Rows: {{ csv_description.shape.0 }},
              Columns: {{ csv_description.shape.1 }}
            </li>
            <li>
              <strong>Duplicates:</strong> {{ csv_description.duplicates }}
            </li>
            {% endif %}
            <div class="divider"></div>
            <h2>Statistics</h2>
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>Statistics</th>
                    <!-- Render the columns of the statistics DataFrame as table headers -->
                    {% for column in csv_description.statistics.columns %}
                    <th>{{ column }}</th>
                    {% endfor %}
                  </tr>
                </thead>
                <tbody>
                  <!-- Iterate over the rows of the statistics DataFrame -->
                  {% for index, row in csv_description.statistics.iterrows %}
                  <tr>
                    <td>{{ index }}</td>
                    <!-- Render the statistics values for each column -->
                    {% for value in row %}
                    <td>{{ value }}</td>
                    {% endfor %}
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            <div class="divider"></div>
            <div class="second-layout">
              <li>
                <h2>Data Types</h2>
                <table>
                  <tr>
                    <th>Attribute</th>
                    <th>Data Type</th>
                  </tr>
                  {% for column, data in csv_description.data_types.items %}
                  <tr>
                    <td>{{ column }}</td>
                    <td>{{ data }}</td>
                  </tr>
                  {% endfor %}
                </table>
              </li>
              <li>
                <h2>Null Values</h2>
                <table>
                  <tr>
                    <th>Attribute</th>
                    <th>Null Count</th>
                    <th>Action</th>
                  </tr>
                  {% for column, null in csv_description.null_values.items %}
                  <tr>
                    <td>{{ column }}</td>
                    <td>{{ null }}</td>
                    <td>
                      <a href="#" onclick="return confirmDrop('{{ column }}')"
                        >Drop</a
                      >
                    </td>
                  </tr>
                  {% endfor %}
                </table>
              </li>
            </div>
          </ul>
        </div>
      </div>
    </section>

    <section id="clean-tool">
      <div class="container">
        <h2>Clean Tool</h2>
        <button
          onclick="window.location.href='/upload?action=remove_missing_values'"
        >
          Remove Missing Values
        </button>
        <button
          onclick="window.location.href='/upload?action=remove_duplicates'"
        >
          Remove Duplicates
        </button>
        <div class="divider"></div>
        <div class="tool-second-layout">
          <h2>Model Tool</h2>
              <select id="model-selection" onchange="updateActionURL()">
                  <option value="decision_tree_classifier">Decision Tree Classifier</option>
                  <!-- You can add more models here -->
              </select>
              <button onclick="trainModel()">
                  Train Model
              </button>
              <button onclick="window.location.href='/upload?action=predict_data'">
                  Predict Data
              </button>
        </div>
      </div>
    </section>

    <section id="visualization">
        <div class="container">
            <h2>Visualization</h2>
            <div id="visualization-container">
                {% for plot in visualizations %}
                <div class="visualization-item">
                    <img src="{% static plot %}" alt="Visualization" />
                </div>
                {% endfor %}
            </div>
        </div>
    </section>


    <section id="test">
      <div class="container">
        <h2>Test Model</h2>
        <form id="test-model-form" method="post" enctype="multipart/form-data" action="{% url 'test_model' %}">
          {% csrf_token %}
          <div class="form-group">
            <label for="model-file" class="dropbox-label">Select Model File</label>
            <input type="file" id="model-file" name="model-file" accept=".joblib,.pkl" required>
          </div>
          <div class="form-group">
            <label for="csv-file" class="dropbox-label">Select CSV Data File</label>
            <input type="file" id="csv-file" name="csv-file" accept=".csv" required>
          </div>
          <button type="submit">Test Model</button>
        </form>
        <div id="prediction-container">
          <!-- This is where prediction results will be displayed -->
        </div>
      </div>
  </section>
  </body>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const navItems = document.querySelectorAll(".nav-item");

      // Add event listener to each nav item
      navItems.forEach(function (navItem) {
        navItem.addEventListener("click", function () {
          // Remove 'active' class from all nav items
          navItems.forEach(function (item) {
            item.classList.remove("active");
            // Also remove 'active' class from the <a> tag inside each nav item
            item.querySelector("a").classList.remove("active");
          });

          // Add 'active' class to the clicked nav item
          navItem.classList.add("active");
          // Also add 'active' class to the <a> tag inside the clicked nav item
          navItem.querySelector("a").classList.add("active");

          // Get the ID of the corresponding section
          const sectionId = navItem
            .querySelector("a")
            .getAttribute("href")
            .substr(1);

          // Hide all sections
          document
            .querySelectorAll(".active-section")
            .forEach(function (section) {
              section.classList.remove("active-section");
            });

          // Show the corresponding section
          document.getElementById(sectionId).classList.add("active-section");
        });
      });
    });

    function removeDup() {
      window.location.href = "/remove_duplicate/";
    }

    function confirmDrop(column) {
      if (
        confirm("Are you sure you want to drop the column '" + column + "'?")
      ) {
        // If the user confirms, proceed with the action
        window.location.href = "/upload?action=drop&column=" + column;
      } else {
        // If the user cancels, do nothing
        return false;
      }
    }

    function updateActionURL() {
        var modelSelection = document.getElementById("model-selection");
        var selectedModel = modelSelection.options[modelSelection.selectedIndex].value;
        var trainModelButton = document.querySelector("button[onclick^='/upload?action=train_model']");

        trainModelButton.setAttribute("onclick", "window.location.href='/upload?action=train_model&name=" + selectedModel + "'");
    }

    function trainModel() {
        var modelSelection = document.getElementById("model-selection");
        var selectedModel = modelSelection.options[modelSelection.selectedIndex].value;
        window.location.href = '/upload?action=train_model&name=' + selectedModel;
    }
  </script>
</html>
